<h2 mat-dialog-title>Figure</h2>

<div class="popup-menu-container"></div>

<mat-dialog-content>
  <div #codemirrorHtmlTemplate class='codemirror-editor' [ngStyle]="{'display': showHTMLEditor ? 'block' : 'none'}"></div>
  <div class="pdf-view-container" [ngStyle]="{'display':showPdfView?'block':'none'}">
    <div class="a4-figure-preview" #a4 [ngStyle]="{'height':(a4.getBoundingClientRect().width*1.4142)+'px','border':'1px dashed black','overflow':'hidden'}">
      <div class="row-component" *ngFor="let row of figureRows" [ngStyle]="{'max-height':maxImgHeightPers+'%',width:'100%'}">
        <div class="cell-component" *ngFor="let i of rowTemplate" [ngStyle]="{width:maxImgWidthPers+'%',height:'100%'}">
          <div *ngIf="row[i]" class="fig-img">
            <img *ngIf="row[i].container.hpers&&row[i].container.wpers" src='{{row[i].container.url}}' [ngStyle]="{width:row[i].container.wpers*a4.getBoundingClientRect().width+'px',height:row[i].container.hpers*a4.getBoundingClientRect().height*(1-bottomOffset)+'px'}">
            <img *ngIf="!(row[i].container.hpers&&row[i].container.wpers)&&row[i].container.height&&!row[i].container.width" src='{{row[i].container.url}}' [ngStyle]="{height:row[i].container.height*a4.getBoundingClientRect().height*(1-bottomOffset)+'px'}" />
            <img *ngIf="!(row[i].container.hpers&&row[i].container.wpers)&&row[i].container.width&&!row[i].container.height" src='{{row[i].container.url}}' [ngStyle]="{width:row[i].container.width*a4.getBoundingClientRect().width+'px'}" />
            <img *ngIf="!(row[i].container.hpers&&row[i].container.wpers)&&row[i].container.width&&row[i].container.height" src='{{row[i].container.url}}' [ngStyle]="{width:row[i].container.width*a4.getBoundingClientRect().width+'px',height:row[i].container.height*a4.getBoundingClientRect().height*(1-bottomOffset)+'px'}"
            />
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="grid-edit">
    <div class="columns-select">
      <mat-form-field appearance="fill">
        <mat-label>Num. of columns</mat-label>
        <mat-select [formControl]="columnsFormControl">
          <mat-option *ngFor="let col of columns" [value]="col">
            {{col}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="reorder-grid" cdkDropListGroup #gridContainer>
      <div *ngFor="let component of figNewComponents; let i = index" cdkDropList [cdkDropListData]="i">
        <div cdkDrag [cdkDragData]="i" (cdkDragEntered)="dragEntered($event)" class="example-box">
          <app-figure-component-preview [(component)]="figNewComponents[i]"></app-figure-component-preview>
          <div class="component-action-btns">
            <div class="drag-container">
              <div class="drag-container-inner">
                <mat-icon class="move-icon" cdkDragHandle>drag_indicator</mat-icon>
              </div>
            </div>
            <div class="actions-container">
              <button mat-stroked-button color="primary" (click)="editComponent(component,i)">Edit</button>
              <button mat-flat-button color="primary" (click)="deleteComponent(component,i)">Delete</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <h3>Figure Description:</h3>
  <div class="pm-editor" #figureDescription>

  </div>
</mat-dialog-content>

<mat-dialog-actions align="end" fxLayoutGap="8px">

  <button mat-stroked-button [mat-dialog-close]="true">Cancel</button>
  <button mat-stroked-button color="{{showHTMLEditor?'primary':'accent'}}" (click)="showHTMLEditor=!showHTMLEditor">Edit HTML</button>
  <button mat-stroked-button color="{{showPdfView?'primary':'accent'}}" (click)="showPdfView=!showPdfView">Show PDF View</button>
  <button mat-flat-button color="primary" (click)="addComponent()">Add Component</button>
  <button mat-flat-button color="primary" (click)="submitFigure()">Submit figure</button>
</mat-dialog-actions>
