<h2 mat-dialog-title class="title-margin-bottom">Add Reference</h2>


<mat-dialog-content>
  <mat-spinner class="loading-data-spinner" [ngStyle]="{display:loadingRefDataFromBackend?'block':'none'}">
  </mat-spinner>
  <mat-tab-group *ngIf="!loadingRefDataFromBackend" class="add-new-ref-tabs" (selectedTabChange)="tabChanged($event)">
    <mat-tab label="Import tools">
      <div class="tab0">

        <div class="mat-form-field-search-label">Search in CrossRef, PubMed, RefBank, Agris, DataCite & GNUB</div>
        <mat-form-field class="search-in-refindit mat-form-field-search" appearance="fill">
          <input type="text"
                 placeholder="Type here..."
                 aria-label="References"
                 matInput
                 #trigger="matAutocompleteTrigger"
                 matAutocompletePosition="below"
                 [formControl]="searchReferencesControl"
                 [matAutocomplete]="auto">
          <mat-icon matPrefix class="prefix-icon">search</mat-icon>
          <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
            <ng-container>
              <mat-option *ngIf="loading" class="is-loading">
                <mat-spinner diameter="25"></mat-spinner>
              </mat-option>
            </ng-container>
            <ng-container *ngIf="searchData">
              <mat-option #optionEl
              (mouseover)="showTooltip($event,option)"
              (mouseout)="hideTooltip()"
              (mousemove)="updatePos($event)"
              [class.demo-row-is-clicked]="option == externalSelection" *ngFor="let option of searchData" [value]="option" (click)="select(option, 'external');$event.stopPropagation(); trigger.openPanel()">
                {{option.ref.title}}
              </mat-option>
            </ng-container>
          </mat-autocomplete>
        </mat-form-field>
      </div>
      <div class="btn-container">
        <button mat-flat-button color="primary" (click)="addReFindItRef()" [disabled]="!externalSelection">Add Reference</button>
      </div>
      <div>
        <div class="mat-form-field-search-label">Select references from Zotero, EndNote or RefManager XML file</div>
        <div class="input-title" style="margin-top: 3px">Please follow the instructions to prepare files from
          <a target="_blank" href="http://arpha.pensoft.net/tips/Zotero">Zotero</a>,
          <a target="_blank" href="http://arpha.pensoft.net/tips/EndNote">EndNote</a> or
          <a target="_blank" href="http://arpha.pensoft.net/tips/Reference-manager">RefManager</a>. <br>
          <p style="margin: 5px 0">If you encounter any issues, please email <a href="mailto:development@pensoft.net">development@pensoft.net</a> and attach the file.</p>
        </div>
        <input type="file"
            (change)="onfileInputChange($event)">
        <button mat-flat-button color="primary" (click)="onFileUpload()">Parse file</button>
      </div>
    </mat-tab>
    <mat-tab label="Manual input">
      <div class="tab1">
        <mat-form-field #referenceType class="select-ref-form-field">
          <mat-label class="">Types:</mat-label>
          <mat-select [formControl]="referenceFormControl" class="select-reference" (selectionChange)="generateFormIOJSON(referenceFormControl.value)">
            <mat-option *ngFor="let type of referenceTypesFromBackend " [value]="type">
              {{type.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill" #referenceType class="select-ref-form-field">
          <mat-label class="">Citation Typing Ontology:</mat-label>
          <mat-select [formControl]="citoFormControl" class="select-reference">
            <mat-option *ngFor="let type of CiToTypes " [value]="type">
              {{type.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <div class="formio-container">
          <div [formGroup]="referenceForms" *ngIf="formIOSchema" class="formio-inner-container">
            <mat-formio #formio [form]="formIOSchema" (change)="onChange($event)"></mat-formio>
          </div>
        </div>
        <div class="btn-container">
          <button mat-raised-button (click)="onSubmit()" [disabled]="!dataSave||!isModified||!isValid">Add Reference</button>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</mat-dialog-content>

<mat-dialog-actions align="end" fxLayoutGap="8px">
  <button mat-stroked-button (click)="closeDialog()">Cancel</button>
  <button mat-flat-button color="primary">Add Reference</button>
</mat-dialog-actions>
