<div class="search-comments">
  <mat-form-field class="search-box-comments" style="background:white;" appearance="fill">
    <mat-label class="character-style-9 label">Search comments...</mat-label>
    <mat-icon class="search-icon" matPrefix>search</mat-icon>
    <input [formControl]="searchForm" matInput style="color: black !important;">
  </mat-form-field>
  <div class="results-from-search" *ngIf="searching">
    <div class="number-results">
      {{searchIndex+1}}/{{searchResults.length}}
    </div>
    <button mat-icon-button [disabled]="searchIndex == 0" (click)="selectPrevComFromSearch()"><mat-icon>arrow_upward</mat-icon></button>
    <button mat-icon-button [disabled]="searchResults&&searchResults.length-1 == searchIndex" (click)="selectNextComFromSearch()"><mat-icon>arrow_downward</mat-icon></button>
    <button mat-icon-button class="end-search-btn" (click)="endSearch()"><mat-icon>close</mat-icon></button>
  </div>
</div>
<div class="comments-wrapper">
  <div style="height:100%;" class="all-comments-container">
    <div [ngStyle]="{'opacity':showAddCommentBox?'1':'0'}" class="add-comment-box">
      <mat-card class="commentBox ">
        <mat-card-header>
          <ngx-avatar mat-card-avatar size="36" [bgColor]="'#00B1B2'" [name]="prosemirrorEditorsService.userInfo.data.name"></ngx-avatar>
          <mat-card-title class="commentBox-title">{{prosemirrorEditorsService.userInfo.data.name}}</mat-card-title>
          <mat-card-subtitle class="commentBox-subtitle"></mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="selected-commet-text">
            <div class="selected-commet-text-title">Selected text:</div>
            <div *ngIf="selectedTextInEditors[lastFocusedEditor!] && commentAllowdIn[lastFocusedEditor!]" class="selected-commet-text-content">{{selectedTextInEditors[lastFocusedEditor!]}}</div>
            <div *ngIf="!commentAllowdIn[lastFocusedEditor!]" class="selected-commet-text-content-no-selection">{{errorMessages[lastFocusedEditor!]}}</div>
          </div>
        </mat-card-content>
        <input #input class="comment-input" type="text" placeholder="Leave a comment..." [formControl]="commentInputFormControl" (keydown)="autocomplete.keyHandle($event)">
        <app-collaborators-auto-complete [(commentmarkId)]="newCommentMarkId" [(inputFormControl)]="commentInputFormControl" #autocomplete></app-collaborators-auto-complete>

        <div class="comment-btns">
          <button mat-button label="Cancel" (click)="cancelBtnHandle()" class="small  secondary cencel-button">Cancel</button>
          <button mat-button label="Comment" (click)="autocomplete.canFinishComment(commentBtnHandle,[input,input.value])" [disabled]="!selectedTextInEditors[lastFocusedEditor!] || input.value.length === 0 || !commentAllowdIn[lastFocusedEditor!]" class="small  secondary comment-button">Comment</button>
        </div>
      </mat-card>
    </div>
    <div *ngFor="let comment of this.allComments" class="comment-container" style="opacity: 0;" attr.commentId="{{comment.commentAttrs.id}}" attr.sectionId="{{comment.section}}" #commentContainer>
      <app-comment [comment]="comment" [(doneRenderingCommentsSubject)]="doneRenderingCommentsSubject" (selected)="changeParentContainer($event,commentContainer,comment)"></app-comment>
    </div>
  </div>

</div>
